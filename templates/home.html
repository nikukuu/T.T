<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="/static/css/home.css">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!--NavBar-->
    <nav class="navbar">

        <ul class="sidebar">


            <li onclick="hideSidebar()">
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></a>
            </li>

            <li>
                <a href="{{ url_for('home') }}">Dashboard</a>
            </li>

                
            <li>
                <a href="{{ url_for('groups') }}">Create Group</a>
            </li>

            <li>
                <a href="{{ url_for('code') }}">Join a Group</a>
            </li>

            <li>
                <a href="{{ url_for('profile') }}">View profile</a>
            </li>

            <li>
                <a href="{{ url_for('base') }}">Logout</a>
            </li>

                
        </ul>


        <a  href="{{ url_for('homepage') }}" class="hideOnMobile">
            <img src="/static/images/favicon_30.png" alt="logo" class="logo">
    
        </a>

        <ul>
            <li class="hideOnMobile">
                <a href="{{ url_for('home') }}">Dashboard</a>
            </li>


                
            <li class="hideOnMobile">
                <a href="{{ url_for('groups') }}">Create Group</a>
            </li>

            <li class="hideOnMobile">
                <a href="{{ url_for('code') }}">Join a Group</a>
            </li>

            <li class="menu-button" onclick="showSidebar()">
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg></a>
            </li>

            <li> </li>
                
        </ul>

        <img src="{{ profile_picture or '/static/images/profile.png' }}" class="user-pic" onclick="toggleMenu()">

        <div class="sub-menu-wrap" id="subMenu">
            <div class="sub-menu">
                <div class="user-info">
                    <img src="{{ profile_picture or '/static/images/profile.png' }}"> <!-- Profile pic in the navbar/ need rin kasama twung nauupdate -->
                    <h3>{{username}}</h3>
                </div>
                <hr>

            <a href="{{url_for('profile')}}" class="sub-menu-link">
                <img src="{{ profile_picture or '/static/images/profile.png' }}"> 
                <p>view profile</p>
                <span></span>
            </a>
            <a href="{{url_for('base')}}" class="sub-menu-link">
                <img src="/static/images/logout.png">
                <p>logout</p>
                <span></span>
            </a>
            </div>
        </div>


    </nav>

<!--Side Bar-->
    <div class="FIX-sidebar">
     
        <ul class="nav">
            <li>
                <a href="#">
                    <span>Dashboard</span>
                </a>
            </li>

            <li>
                <a href="{{ url_for('history') }}">
                    <span>History</span>
                </a>
            </li>

            <li>
                <a href="{{ url_for('active_groups') }}">
                    <span>Statistics</span>
                </a>
            </li>

            <li>
                <a href="{{ url_for('activity') }}">
                    <span>Activity</span>
                </a>
            </li>
        </ul>
    </div>


<!--Buttons-->





<section class="home">
    <div class="content">
        <div class="owe-section">
            <div class="owe">
                <h3>You Owe</h3>
                <p>₱{{ total_owed }}</p>
            </div>

            <div class="who-owe">
                <h3>You are owed</h3>
                {% if borrowers %}
                    <ul>
                        {% for borrower in borrowers %}
                            <li>{{ borrower['borrower'] }} - ₱{{ borrower['total_amount'] }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No users owe you money.</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<section class="groups-and-expenses">
    <div class="container">
        <h3>Your Active Groups</h3>
        {% if rooms_dict %}
            <ul>
                {% for room_id, room_info in rooms_dict.items() %}
                    <li>
                        <strong>{{ room_info.group_name }}</strong> 
                        {% if room_info.is_active %}
                            {% if username == room_info.creator %}
                                <div class="action-buttons">
                                    <a href="{{ url_for('mainF', room_id=room_id) }}" class="button">Add Expense</a>
                                    <a href="{{ url_for('settle_up', room_id=room_id) }}" class="button">Settle Up</a>
                                </div>
                            {% endif %}
                            <ul>
                                {% if expenses_dict.get(room_id) %}
                                    {% for expense in expenses_dict[room_id] %}
                                        <li>
                                            {{ expense.description }}
                                            <ul>
                                                <li>Amount: ₱{{ expense.amount }}</li>
                                                <li>{{ expense.paid_by }} paid ₱{{ expense.amount }}</li>
                                                <li>Added on: {{ expense.created_at.strftime('%b %d, %Y') }}</li>
                                                {% if username == room_info.creator %}
                                                    <a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit Expense</a>
                                                {% endif %}
                                                <ul>
                                                    {% for member in members_dict[room_id] %}
                                                        <li>{{ member }} owes ₱{{ (expense.amount / members_dict[room_id] | length) | round(2) }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </ul>
                                        </li>
                                    {% endfor %}
                                {% else %}
                                    <li>No expenses yet.</li>
                                {% endif %}
                            </ul>
                            {% if username == room_info.creator %}
                                <form action="{{ url_for('end_group', room_id=room_id) }}" method="post" class="end-group-form">
                                    <button type="submit" class="end-group-button">End Group</button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You are not a member of any active groups yet.</p>
        {% endif %}
    </div>
</section>

<script src="/static/js/home.js"></script>

</body>
</html>
