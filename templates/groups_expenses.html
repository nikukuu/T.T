<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groups and Expenses</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/static/css/gs.css"> <!-- Link to your CSS file -->
</head>
<body>
    <nav>
        <a href="{{ url_for('home') }}" class="logo">
            <img src="/static/images/favicon_30.png" alt="logo">
            <span class="logo-name">SplitShare</span>
        </a>
    </nav>
    
    <div class="container">
        <h3>Your Active Groups</h3>
        {% if rooms_dict %}
            <ul class="group-list">
                {% for room_id, room_info in rooms_dict.items() %}
                    <li class="group-item">
                        <div class="group-header">
                            <strong>{{ room_info.group_name }}</strong>
                            {% if room_info.is_active %}
                                {% if username == room_info.creator %}
                                    <div class="action-buttons">
                                        <a href="{{ url_for('mainF', room_id=room_id) }}" class="button">Add Expense</a>
                                        <a href="{{ url_for('settle_up', room_id=room_id) }}" class="button">Settle Up</a>
                                        <a href="{{ url_for('statistics', room_id=room_id) }}" class="button">View Statistics</a>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                        <ul class="expense-list">
                            {% if expenses_dict.get(room_id) %}
                                {% for expense in expenses_dict[room_id] %}
                                    <li class="expense-item">
                                        <div class="expense-details">
                                            <p><strong>{{ expense.description }}</strong></p>
                                            <p>Amount: ₱{{ expense.amount }}</p>
                                            <p>{{ expense.paid_by }} paid ₱{{ expense.amount }}</p>
                                            <p>Added on: {{ expense.created_at.strftime('%b %d, %Y') }}</p>
                                            {% if username == room_info.creator %}
                                                <a href="{{ url_for('edit_expense', expense_id=expense.id) }}" class="edit-link">Edit Expense</a>
                                            {% endif %}
                                        </div>
                                        <ul class="members-list">
                                            {% for member in members_dict[room_id] %}
                                                <li>{{ member }} owes ₱{{ (expense.amount / members_dict[room_id] | length) | round(2) }}</li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li>No expenses yet.</li>
                            {% endif %}
                        </ul>
                        {% if username == room_info.creator %}
                            <form action="{{ url_for('end_group', room_id=room_id) }}" method="post" class="end-group-form">
                                <button type="submit" class="end-group-button">End Group</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You are not a member of any active groups yet.</p>
        {% endif %}
    </div>
</body>
</html>
