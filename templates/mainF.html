<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Function</title>
</head>
<body>
    <h1>Main Function</h1>

    {% if success == 'True' %}
        <p>Expense successfully added!</p>
    {% elif success == 'False' %}
        <p>Failed to add expense. Please try again.</p>
    {% endif %}

    <hr>

    {% if room_id %}
        <p>Room ID: {{ room_id }}</p>
        <h2>Members who have joined:</h2>
        <ul>
            {% for member in members %}
                <li>{{ member.username }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No rooms have been created yet.</p>
    {% endif %}
    
    <hr>

    {% if username == room_info.creator %}
        <form action="{{ url_for('add_expense') }}" method="POST">
            <p>Enter description:</p>
            <input type="text" name="description" required>
            <p>Expense: ₱<input type="number" step="0.01" name="expense" required></p>
            <p>Paid by:
                <select name="paid_by" required>
                    {% for member in members %}
                        <option value="{{ member.username }}">{{ member.username }}</option>
                    {% endfor %}
                </select>
            </p>
            <input type="hidden" name="room_id" value="{{ room_id }}">
            <button type="submit">Add Expense</button>
        </form>
    {% endif %}

    <hr>

    <h2>Expenses</h2>
    {% if has_expenses %}
        <ul>
            {% for expense in expenses %}
                <li>
                    {{ expense.description }}
                    <ul>
                        <li>Amount: ₱{{ expense.amount }}</li>
                        <li>{{ expense.paid_by }} paid ₱{{ expense.amount }}</li>
                        <li>Added on: {{ expense.created_at.strftime('%b %d, %Y') }}</li>
                        {% if username == room_info.creator %}
                            <a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit Expense</a>
                        {% endif %}
                        <ul>
                            {% for member in members %}
                                <li>{{ member.username }} owes ₱{{ (expense.amount / members|length) | round(2) }}</li>
                            {% endfor %}
                        </ul>
                    </ul>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No expenses yet.</p>
    {% endif %}

    {% if username == room_info.creator %}
        <form action="{{ url_for('end_group', room_id=room_id) }}" method="post">
            <button type="submit">End Group</button>
        </form>
        <a href="{{ url_for('settle_up', room_id=room_id) }}">Settle Up</a>
        <a href="{{ url_for('statistics', room_id=room_id) }}">View Statistics</a>
    {% endif %}

    <div>
        <a href="{{ url_for('home') }}">Dashboard</a>
        <a href="{{ url_for('groups') }}">Create Group</a>
        <a href="{{ url_for('code') }}">Join a Group</a>
        <a href="{{ url_for('profile') }}">Profile</a>
        <a href="{{ url_for('base') }}">Logout</a>
        
        <a href="{{ url_for('home') }}">Dashboard</a>
        <a href="{{ url_for('history') }}">History</a>
        <a href="{{ url_for('active_groups') }}">Statistics</a>
        <a href="{{ url_for('activity') }}">Activity</a>
    </div>
</body>
</html>