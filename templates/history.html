<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitShare</title>
    <link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/history.css">
    <link rel="icon" type="image/png" href="/static/images/favicon40.png">
</head>
<body>

  <nav>
    <div class="logo">
      <i class="bx bx-menu menu-icon"></i>
      <a href="{{ url_for('homepage') }}" class="hideOnMobile">
          <img src="/static/images/favicon_30.png" alt="logo" class="logo">
      </a>
    </div>
    
    <div class="sidebar">
      <div class="logo">
        <i class="bx bx-menu menu-icon"></i>
        <span class="logo-name">SplitShare</span>
      </div>

      <div class="sidebar-content">
        <ul class="lists">
          <li class="list dropdown">
            <!-- Dashboard Link -->
            <div class="dropdown-toggle" id="dashboard-toggle">
              <a href="{{ url_for('home') }}" class="nav-link">
                <i class="bx bx-home-alt icon"></i>
                <span class="link">Dashboard</span>
              </a>
              <i class="bx bx-chevron-down icon"></i> <!-- Down Icon -->
            </div>
            <!-- Dropdown Menu -->
            <div class="dropdown-content" id="dropdown-menu">
              <a href="{{ url_for('groups') }}" class="nav-link">
                <i class="bx bx-group icon"></i> <!-- Icon for Create Group -->
                Create Group
              </a>
              <a href="{{ url_for('code') }}" class="nav-link">
                <i class="bx bx-code-alt icon"></i> <!-- Icon for Join Group -->
                Join Group
              </a>
              <a href="{{ url_for('groups_list') }}" class="nav-link">
                <i class="bx bx-calendar icon"></i> <!-- Icon for Groups -->
                Groups
              </a>
            </div>
          </li>

          <li class="list">
            <a href="{{ url_for('activity') }}" class="nav-link">
              <i class="bx bx-time-five icon"></i> <!-- Icon for Recent Activity -->
              <span class="link">Recent Activity</span>
            </a>
          </li>

          <li class="list">
            <a href="{{ url_for('active_groups') }}" class="nav-link">
              <i class="bx bx-pie-chart-alt-2 icon"></i>
              <span class="link">Analytics</span>
            </a>
          </li>

          <li class="list">
            <a href="{{ url_for('history') }}" class="nav-link">
              <i class="bx bx-time icon"></i> <!-- Icon for History -->
              <span class="link">History</span>
            </a>
          </li>
        </ul>

        <div class="bottom-content">
          <li class="list">
            <a href="{{ url_for('profile') }}" class="nav-link">
              <i class="bx bx-user icon"></i> <!-- Icon for Profile -->
              <span class="link">Profile</span>
            </a>
          </li>

          <li class="list">
            <a href="{{ url_for('base') }}" class="nav-link">
              <i class="bx bx-log-out icon"></i> <!-- Icon for Logout -->
              <span class="link">Logout</span>
            </a>
          </li>
        </div>
      </div>
    </div>
  </nav>

    <div class="container">
        <h1>History</h1>
        <div class="history-content">
            {% if rooms_dict %}
                <ul class="group-list">
                    {% for room_id, room_info in rooms_dict.items() %}
                        <li class="group-item">
                            <strong class="group-name">{{ room_info.group_name }}</strong> 
                            <span class="group-date">(created on: {{ room_info.created_at.strftime('%b %d, %Y') }})</span>
                            <p>This group was ended on: {{ room_info.ended_at.strftime('%b %d, %Y') if room_info.ended_at else 'N/A' }}</p>
                            <ul class="expense-list">
                                {% if expenses_dict.get(room_id) %}
                                    {% for expense in expenses_dict[room_id] %}
                                        <li class="expense-item">
                                            <span class="expense-description">{{ expense.description }}</span>
                                            <ul class="expense-details">
                                                <li>Amount: ₱{{ expense.amount }}</li>
                                                <li>{{ expense.paid_by }} paid ₱{{ expense.amount }}</li>
                                                <li>Added on: {{ expense.created_at.strftime('%b %d, %Y') }}</li>
                                                <ul class="member-list">
                                                    {% for member in members_dict[room_id] %}
                                                        <li>{{ member }} owes ₱{{ (expense.amount / members_dict[room_id] | length) | round(2) }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </ul>
                                        </li>
                                    {% endfor %}
                                {% else %}
                                    <li>No expenses yet.</li>
                                {% endif %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have no ended groups yet.</p>
            {% endif %}
        </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
          const dashboardToggle = document.getElementById('dashboard-toggle');
          const dropdownMenu = document.getElementById('dropdown-menu');
          const icon = dashboardToggle.querySelector('.bx-chevron-down');

          dashboardToggle.addEventListener('click', function() {
              dropdownMenu.classList.toggle('show');
              icon.classList.toggle('rotate');
          });
      });
  </script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>